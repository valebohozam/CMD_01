<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ProBuild ¬∑ Empleados</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    :root{
      --primary-color:#ff6b35; --secondary-color:#1a1a2e; --accent-color:#0f4c75;
      --text-light:#ffffff; --text-dark:#2c3e50; --background-light:#f8f9fa;
      --gradient-primary:linear-gradient(135deg,#ff6b35 0%,#ff8c42 100%);
      --gradient-secondary:linear-gradient(135deg,#1a1a2e 0%,#16213e 100%);
      --shadow-primary:0 20px 60px rgba(255,107,53,.3); --shadow-secondary:0 10px 30px rgba(0,0,0,.2);
      --card-bg:#fff; --border-color:#e9ecef; --success:#28a745; --warning:#ffc107; --danger:#dc3545; --info:#17a2b8;
    }
    body{ font-family:'Inter',sans-serif; color:var(--text-dark); background:var(--background-light); }

    /* Sidebar */
    .sidebar{ position:fixed; inset:0 auto 0 0; width:280px; background:var(--gradient-secondary); padding:2rem 0; z-index:1000; }
    .sidebar-header{ padding:0 2rem; margin-bottom:2rem; }
    .sidebar-logo{ font-size:1.6rem; font-weight:800; text-decoration:none; background:var(--gradient-primary); -webkit-background-clip:text; -webkit-text-fill-color:transparent; background-clip:text; }
    .sidebar-nav{ list-style:none; }
    .nav-item{ margin-bottom:.4rem; }
    .nav-link{ display:flex; align-items:center; gap:.8rem; padding:1rem 2rem; color:rgba(255,255,255,.82); text-decoration:none; border-left:4px solid transparent; transition:.2s ease; }
    .nav-link:hover{ background:rgba(255,107,53,.08); color:#fff; }
    .nav-link.active{ background:rgba(255,107,53,.12); color:#fff; border-left-color:#ff845a; }
    .nav-icon{ font-size:1.2rem; }

    /* Main */
    .main{ margin-left:280px; padding:2rem; min-height:100vh; }
    .top-bar{ background:var(--card-bg); border-radius:15px; padding:1.2rem 1.6rem; box-shadow:var(--shadow-secondary); display:flex; align-items:center; justify-content:space-between; }
    .user{ display:flex; align-items:center; gap:.8rem; }
    .avatar{ width:40px; height:40px; border-radius:50%; background:var(--gradient-primary); display:grid; place-items:center; color:#fff; font-weight:700; }

    /* Toolbar */
    .toolbar{ margin:1.2rem 0 1.6rem; display:flex; gap:.6rem; flex-wrap:wrap; }
    .btn{ padding:.7rem 1rem; border:none; border-radius:12px; font-weight:700; cursor:pointer; display:inline-flex; align-items:center; gap:.5rem; }
    .btn-primary{ background:var(--gradient-primary); color:#fff; box-shadow:var(--shadow-primary); }
    .btn-outline{ background:#fff; border:2px solid var(--border-color); }
    .btn-ghost{ background:transparent; color:#334155; }
    .input, select, textarea{ padding:.75rem 1rem; border:1px solid var(--border-color); border-radius:12px; outline:none; }
    .input:focus, select:focus, textarea:focus{ border-color:#cfd4da; box-shadow:0 0 0 4px rgba(15,76,117,.06); }

    /* Cards & Tables */
    .card{ background:#fff; border-radius:16px; box-shadow:var(--shadow-secondary); overflow:hidden; }
    .card-header{ display:flex; align-items:center; justify-content:space-between; padding:1rem 1.2rem; border-bottom:1px solid var(--border-color); }
    .card-title{ font-size:1.1rem; font-weight:800; }
    table{ width:100%; border-collapse:collapse; }
    th, td{ padding:1rem 1.2rem; border-bottom:1px solid var(--border-color); text-align:left; }
    th{ background:var(--background-light); font-size:.85rem; text-transform:uppercase; letter-spacing:.4px; }
    tr:hover{ background:rgba(255,107,53,.04); }

    .status{ padding:.4rem .7rem; border-radius:999px; font-weight:800; font-size:.75rem; letter-spacing:.3px; text-transform:uppercase; }
    .st-progress{ background:rgba(40,167,69,.15); color:var(--success); }
    .st-pending{ background:rgba(255,193,7,.15); color:var(--warning); }
    .st-risk{ background:rgba(220,53,69,.15); color:var(--danger); }
    .st-done{ background:rgba(23,162,184,.15); color:var(--info); }

    .bar{ width:100px; height:6px; background:var(--border-color); border-radius:4px; overflow:hidden; }
    .bar > i{ display:block; height:100%; background:var(--primary-color); }

    .actions{ display:flex; gap:.4rem; }
    .icon{ border:none; border-radius:10px; padding:.5rem .6rem; cursor:pointer; }
    .icon.view{ background:rgba(15,76,117,.12); color:var(--accent-color); }
    .icon.report{ background:rgba(255,107,53,.12); color:#d3542a; }

    /* Drawer (Encargos) */
    .drawer{ position:fixed; top:0; right:-420px; width:420px; height:100vh; background:#fff; box-shadow:-24px 0 60px rgba(0,0,0,.15); transition:right .25s ease; z-index:1200; display:flex; flex-direction:column; }
    .drawer.open{ right:0; }
    .drawer-head{ padding:1rem 1.2rem; border-bottom:1px solid var(--border-color); display:flex; align-items:center; justify-content:space-between; }
    .drawer-body{ padding:1rem 1.2rem; overflow:auto; }
    .task{ padding:.9rem; border:1px solid var(--border-color); border-radius:12px; margin-bottom:.7rem; display:flex; gap:.7rem; align-items:start; }
    .task .title{ font-weight:800; }
    .pill{ padding:.25rem .6rem; border-radius:999px; font-size:.72rem; font-weight:800; }
    .prio-high{ background:rgba(220,53,69,.12); color:var(--danger); }
    .prio-med{ background:rgba(255,193,7,.18); color:#8a6d00; }
    .prio-low{ background:rgba(40,167,69,.15); color:var(--success); }

    /* Modal (Informe) */
    .backdrop{ position:fixed; inset:0; background:rgba(0,0,0,.5); display:none; align-items:center; justify-content:center; padding:1rem; z-index:1300; }
    .modal{ width:100%; max-width:720px; background:#fff; border-radius:16px; box-shadow:0 30px 80px rgba(0,0,0,.28); overflow:hidden; transform:translateY(6px); opacity:0; transition:opacity .2s ease, transform .2s ease; }
    .modal.open{ opacity:1; transform:translateY(0); }
    .modal-header{ padding:1rem 1.2rem; border-bottom:1px solid var(--border-color); display:flex; align-items:center; justify-content:space-between; }
    .modal-body{ padding:1rem 1.2rem; }
    .grid{ display:grid; grid-template-columns: repeat(2, 1fr); gap:.9rem; }
    .grid-1{ grid-template-columns:1fr; }
    .field{ display:flex; flex-direction:column; gap:.35rem; }
    .label{ font-size:.9rem; font-weight:800; }
    .modal-actions{ border-top:1px solid var(--border-color); padding:1rem 1.2rem; display:flex; justify-content:flex-end; gap:.6rem; background:#fafbfc; }

    /* Toasts */
    .toasts{ position:fixed; right:20px; bottom:20px; display:flex; flex-direction:column; gap:.6rem; z-index:1400; }
    .toast{ background:#fff; border-left:6px solid var(--primary-color); padding:.85rem 1rem; border-radius:12px; box-shadow:0 14px 40px rgba(0,0,0,.12); min-width:260px; }
    .toast.success{ border-left-color:var(--success); }
    .toast.warn{ border-left-color:var(--warning); }
    .toast.error{ border-left-color:var(--danger); }

    /* Reports list */
    .muted{ color:#6c757d; font-size:.9rem; }

    /* Responsive */
    @media (max-width: 1024px){ .main{ margin-left:0; padding:1rem; } .sidebar{ transform:translateX(-100%);} .sidebar.open{ transform:translateX(0);} .drawer{ width:92vw; } .grid{ grid-template-columns:1fr; } }
  </style>
</head>
<body>
  <!-- Sidebar (enfocado a empleado) -->
  <aside class="sidebar" id="sidebar">
    <div class="sidebar-header"><a href="#" class="sidebar-logo">ProBuild</a></div>
    <ul class="sidebar-nav">
      <li class="nav-item"><a class="nav-link active" href="#" data-section="mis-proyectos"><span class="nav-icon">üèóÔ∏è</span> Mis Proyectos</a></li>
      <li class="nav-item"><a class="nav-link" href="#" data-section="encargos"><span class="nav-icon">üß∞</span> Encargos</a></li>
      <li class="nav-item"><a class="nav-link" href="#" data-section="informes"><span class="nav-icon">üìù</span> Mis Informes</a></li>
      <li class="nav-item"><a class="nav-link" href="#" data-section="perfil"><span class="nav-icon">üë§</span> Mi Perfil</a></li>
      <li class="nav-item"><a class="nav-link" href="#" data-section="ayuda"><span class="nav-icon">‚ùì</span> Ayuda</a></li>
      <li class="nav-item"><a class="nav-link" href="#" id="logout"><span class="nav-icon">üö™</span> Salir</a></li>
    </ul>
  </aside>

  <!-- Contenido principal -->
  <main class="main">
    <section class="top-bar">
      <h1 class="page">Mis Proyectos</h1>
      <div class="user"><div class="avatar">BN</div><div><div style="font-weight:800">Benjam√≠n Novoa</div><div class="muted">Empleado</div></div></div>
    </section>

    <!-- Toolbar empleados -->
    <div class="toolbar">
      <button class="btn btn-primary" id="btnNewReport">üìù Nuevo informe</button>
      <input class="input" id="search" placeholder="Buscar proyecto por nombre, c√≥digo o cliente..." />
      <select id="filterEstado">
        <option value="">Todos los estados</option>
        <option value="EN_PROGRESO">En Progreso</option>
        <option value="PENDIENTE">Pendiente</option>
        <option value="COMPLETADO">Completado</option>
        <option value="EN_RIESGO">En Riesgo</option>
      </select>
      <button class="btn btn-outline" id="toggleSidebar">‚ò∞ Men√∫</button>
    </div>

    <!-- Lista de proyectos asignados -->
    <section class="card" id="cardProyectos">
      <div class="card-header">
        <div class="card-title">Proyectos asignados</div>
        <div class="muted"><span id="count"></span></div>
      </div>
      <div style="overflow-x:auto">
        <table id="tabla">
          <thead>
            <tr>
              <th>Proyecto</th>
              <th>C√≥digo</th>
              <th>Cliente</th>
              <th>Progreso</th>
              <th>Estado</th>
              <th>Fecha L√≠mite</th>
              <th>Acciones</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </section>

    <!-- Mis informes (historial) -->
    <section class="card" style="margin-top:1.6rem" id="cardInformes">
      <div class="card-header">
        <div class="card-title">Mis informes enviados</div>
        <div><button class="btn btn-ghost" id="refreshReports">‚Üª Actualizar</button></div>
      </div>
      <div style="overflow-x:auto">
        <table id="tablaInformes">
          <thead>
            <tr>
              <th>Fecha</th>
              <th>Proyecto</th>
              <th>Estado reportado</th>
              <th>Avance</th>
              <th>Horas</th>
              <th>Observaciones</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </section>
  </main>

  <!-- Drawer Encargos -->
  <aside class="drawer" id="drawer">
    <div class="drawer-head">
      <div>
        <div class="muted">Encargos del proyecto</div>
        <div id="drawerTitle" style="font-weight:800">‚Äî</div>
      </div>
      <button class="btn btn-outline" id="closeDrawer">‚úñ</button>
    </div>
    <div class="drawer-body" id="drawerBody">
      <!-- tasks injected here -->
    </div>
  </aside>

  <!-- Modal Informe -->
  <div class="backdrop" id="backdrop">
    <div class="modal" id="modal">
      <div class="modal-header">
        <div style="font-weight:800">Nuevo informe</div>
        <button class="btn btn-outline" id="btnClose">‚úñ</button>
      </div>
      <form id="formInforme">
        <div class="modal-body">
          <div class="grid">
            <div class="field">
              <label class="label">Proyecto</label>
              <select name="proyecto" required id="selectProyecto"></select>
            </div>
            <div class="field">
              <label class="label">Fecha</label>
              <input class="input" name="fecha" type="date" required />
            </div>
            <div class="field">
              <label class="label">Estado</label>
              <select name="estado" required>
                <option value="EN_PROGRESO">En Progreso</option>
                <option value="EN_RIESGO">En Riesgo</option>
                <option value="CON_RETRASOS">Con Retrasos</option>
                <option value="COMPLETADO">Completado</option>
              </select>
            </div>
            <div class="field">
              <label class="label">Avance (%)</label>
              <input class="input" name="avance" type="number" min="0" max="100" step="1" value="0" required />
            </div>
            <div class="field">
              <label class="label">Horas invertidas</label>
              <input class="input" name="horas" type="number" min="0" step="0.5" value="0" />
            </div>
            <div class="field">
              <label class="label">Adjuntos (opcional)</label>
              <input class="input" name="adjuntos" type="file" multiple />
            </div>
          </div>
          <div class="grid grid-1" style="margin-top:.6rem">
            <div class="field">
              <label class="label">Resumen / Actividades realizadas</label>
              <textarea name="resumen" rows="3" placeholder="Describe brevemente los avances realizados..."></textarea>
            </div>
            <div class="field">
              <label class="label">Bloqueos / Riesgos</label>
              <textarea name="bloqueos" rows="2" placeholder="¬øHay impedimentos, riesgos o necesidades?"></textarea>
            </div>
          </div>
        </div>
        <div class="modal-actions">
          <button type="button" class="btn btn-outline" id="btnCancel">Cancelar</button>
          <button type="submit" class="btn btn-primary">Enviar informe</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Toasts -->
  <div class="toasts" id="toasts"></div>

  <script>
    // ===== Helpers =====
    const qs = (s, el=document)=> el.querySelector(s);
    const qsa = (s, el=document)=> [...el.querySelectorAll(s)];
    const fmtDate = (iso)=> iso? new Date(iso).toLocaleDateString('es-CO', {day:'2-digit', month:'short', year:'numeric'}) : '';

    const Toast = { show(msg, kind='success') { const el = document.createElement('div'); el.className = `toast ${kind}`; el.innerHTML = msg; qs('#toasts').appendChild(el); setTimeout(()=>{ el.style.opacity=.9 }, 10); setTimeout(()=>{ el.style.opacity=0; setTimeout(()=> el.remove(), 220) }, 3000);} };

    // ===== Mock store (reemplazable por API) =====
    const K_PROJ = 'emp_projects';
    const K_TASK = 'emp_tasks';
    const K_REP  = 'emp_reports';
    const EMP_ID = 'emp-001';

    const Store = {
      read(k){ return JSON.parse(localStorage.getItem(k)||'[]'); },
      save(k,v){ localStorage.setItem(k, JSON.stringify(v)); },
      seed(){
        if(!this.read(K_PROJ).length){
          const now = Date.now();
          this.save(K_PROJ,[
            {id:'p1', nombre:'Torre Empresarial Norte', codigo:'TEN-2024-001', cliente:'Constructora Moderna', progreso:75, estado:'EN_PROGRESO', fechaLimite:'2024-11-15', asignados:[EMP_ID], createdAt:now-1000},
            {id:'p2', nombre:'Residencial Los Pinos', codigo:'RLP-2024-002', cliente:'Inmobiliaria Central', progreso:45, estado:'PENDIENTE', fechaLimite:'2024-12-28', asignados:[EMP_ID], createdAt:now-2000},
            {id:'p3', nombre:'Centro Comercial Plaza', codigo:'CCP-2024-003', cliente:'Desarrollos Urbanos', progreso:100, estado:'COMPLETADO', fechaLimite:'2024-09-30', asignados:[EMP_ID], createdAt:now-3000}
          ]);
        }
        if(!this.read(K_TASK).length){
          this.save(K_TASK,[
            {id:'t1', proyecto:'p1', titulo:'Cimentaci√≥n Torre A', descripcion:'Verificar encofrado y armado', prioridad:'ALTA', vence:'2024-10-05', estado:'EN_CURSO'},
            {id:'t2', proyecto:'p1', titulo:'Instalaciones el√©ctricas piso 3', descripcion:'Tendido de cableado', prioridad:'MEDIA', vence:'2024-10-12', estado:'PENDIENTE'},
            {id:'t3', proyecto:'p2', titulo:'Urbanismo acceso principal', descripcion:'Cordones y andenes', prioridad:'BAJA', vence:'2024-11-20', estado:'PENDIENTE'},
            {id:'t4', proyecto:'p3', titulo:'Entrega locales 12-20', descripcion:'Lista de chequeo final', prioridad:'ALTA', vence:'2024-09-20', estado:'COMPLETADO'}
          ]);
        }
        if(!this.read(K_REP).length){ this.save(K_REP, []); }
      },
      assignedProjects(empId){ return this.read(K_PROJ).filter(p=> (p.asignados||[]).includes(empId)); },
      tasksByProject(pid){ return this.read(K_TASK).filter(t=> t.proyecto===pid); },
      addReport(rep){ const all = this.read(K_REP); all.unshift(rep); this.save(K_REP, all); }
    };

    // ===== State =====
    const state = { search:'', filtro:'', selectedProject:null };

    // ===== Render =====
    function progressBar(p){ return `<div class="bar"><i style="width:${p||0}%"></i></div> <span style="margin-left:.5rem">${p||0}%</span>`; }
    function statusBadge(st){ const cls = {EN_PROGRESO:'st-progress', PENDIENTE:'st-pending', EN_RIESGO:'st-risk', COMPLETADO:'st-done'}[st]||'st-pending'; const lbl = {EN_PROGRESO:'En Progreso', PENDIENTE:'Pendiente', EN_RIESGO:'En Riesgo', COMPLETADO:'Completado'}[st]||st; return `<span class="status ${cls}">${lbl}</span>`; }

    function applyFilters(list){ let out=[...list]; const s=state.search.trim().toLowerCase(); if(s){ out=out.filter(p=> `${p.nombre} ${p.codigo} ${p.cliente}`.toLowerCase().includes(s)); } if(state.filtro){ out=out.filter(p=> p.estado===state.filtro); } out.sort((a,b)=> b.createdAt-a.createdAt); return out; }

    function renderProyectos(){
      const list = applyFilters(Store.assignedProjects(EMP_ID));
      qs('#count').textContent = `${list.length} proyecto(s)`;
      qs('#tabla tbody').innerHTML = list.map(p=>`
        <tr>
          <td style="font-weight:800">${p.nombre}</td>
          <td>${p.codigo}</td>
          <td>${p.cliente}</td>
          <td style="display:flex; align-items:center; gap:.5rem">${progressBar(p.progreso)}</td>
          <td>${statusBadge(p.estado)}</td>
          <td>${fmtDate(p.fechaLimite)}</td>
          <td class="actions">
            <button class="icon view" title="Ver encargos" onclick="openDrawer('${p.id}')">üß∞</button>
            <button class="icon report" title="Enviar informe" onclick="openReport('${p.id}')">üìù</button>
          </td>
        </tr>`).join('');
    }

    function renderInformes(){
      const rows = (Store.read(K_REP)||[]).map(r=>{
        const pj = Store.read(K_PROJ).find(p=>p.id===r.proyecto);
        return `<tr>
          <td>${fmtDate(r.fecha)}</td>
          <td>${pj? pj.nombre: r.proyecto}</td>
          <td>${statusBadge(r.estado)}</td>
          <td>${r.avance}%</td>
          <td>${Number(r.horas||0)}</td>
          <td>${(r.resumen||'').slice(0,120)}</td>
        </tr>`;
      }).join('');
      qs('#tablaInformes tbody').innerHTML = rows || `<tr><td colspan="6" class="muted">A√∫n no has enviado informes.</td></tr>`;
    }

    // ===== Drawer (Encargos) =====
    function openDrawer(pid){
      const p = Store.read(K_PROJ).find(x=>x.id===pid); if(!p) return;
      qs('#drawerTitle').textContent = `${p.nombre} ¬∑ ${p.codigo}`;
      const tasks = Store.tasksByProject(pid);
      qs('#drawerBody').innerHTML = tasks.map(t=>{
        const pr = t.prioridad==='ALTA'?'prio-high':(t.prioridad==='MEDIA'?'prio-med':'prio-low');
        return `<article class="task">
          <div style="flex:1">
            <div class="title">${t.titulo}</div>
            <div class="muted">${t.descripcion||''}</div>
            <div style="display:flex; gap:.5rem; margin-top:.35rem">
              <span class="pill ${pr}">Prioridad ${t.prioridad}</span>
              <span class="pill">Vence: ${fmtDate(t.vence)}</span>
              <span class="pill">Estado: ${t.estado}</span>
            </div>
          </div>
        </article>`;
      }).join('') || `<div class="muted">No hay encargos para este proyecto.</div>`;
      qs('#drawer').classList.add('open');
    }
    qs('#closeDrawer').addEventListener('click', ()=> qs('#drawer').classList.remove('open'));

    // ===== Modal (Informe) =====
    function openModal(){ qs('#backdrop').style.display = 'flex'; requestAnimationFrame(()=> qs('#modal').classList.add('open')); }
    function closeModal(){ qs('#modal').classList.remove('open'); setTimeout(()=> qs('#backdrop').style.display='none', 150); qs('#formInforme').reset(); }
    qs('#btnClose').addEventListener('click', closeModal);
    qs('#btnCancel').addEventListener('click', closeModal);

    function openReport(pid){ // abre modal preseleccionando proyecto
      const select = qs('#selectProyecto');
      const list = Store.assignedProjects(EMP_ID);
      select.innerHTML = list.map(p=> `<option value="${p.id}">${p.nombre} (${p.codigo})</option>`).join('');
      if(pid) select.value = pid;
      // Fecha por defecto hoy
      qs('[name="fecha"]').value = new Date().toISOString().slice(0,10);
      openModal();
    }

    // Env√≠o de informe
    qs('#formInforme').addEventListener('submit', e=>{
      e.preventDefault();
      const fd = new FormData(e.target);
      const avance = Number(fd.get('avance'));
      if(avance < 0 || avance > 100){ Toast.show('<b>El avance debe estar entre 0 y 100.</b>','warn'); return; }
      const rep = {
        id: crypto.randomUUID(),
        empleado: EMP_ID,
        proyecto: fd.get('proyecto'),
        fecha: fd.get('fecha'),
        estado: fd.get('estado'),
        avance: avance,
        horas: Number(fd.get('horas')||0),
        resumen: fd.get('resumen')||'',
        bloqueos: fd.get('bloqueos')||'',
        adjuntos: [...(fd.getAll('adjuntos')||[])].map(f=> f.name).slice(0,5),
        createdAt: Date.now()
      };
      Store.addReport(rep);
      Toast.show('Informe enviado correctamente.','success');
      closeModal();
      renderInformes();
    });

    // ===== Navigation & Filters =====
    qs('#search').addEventListener('input', e=>{ state.search = e.target.value; renderProyectos(); });
    qs('#filterEstado').addEventListener('change', e=>{ state.filtro = e.target.value; renderProyectos(); });
    qs('#btnNewReport').addEventListener('click', ()=> openReport(state.selectedProject));

    // Sidebar toggle (m√≥vil)
    qs('#toggleSidebar').addEventListener('click', ()=> qs('#sidebar').classList.toggle('open'));
    qs('#logout').addEventListener('click', (e)=>{ e.preventDefault(); alert('Cerrando sesi√≥n...'); });

    // Tabs (lado izquierdo)
    qsa('.nav-link').forEach(a=> a.addEventListener('click', (e)=>{
      e.preventDefault();
      qsa('.nav-link').forEach(x=> x.classList.remove('active'));
      a.classList.add('active');
      const sec = a.dataset.section;
      const title = { 'mis-proyectos':'Mis Proyectos', 'encargos':'Encargos', 'informes':'Mis Informes', 'perfil':'Mi Perfil', 'ayuda':'Ayuda' }[sec] || 'Mis Proyectos';
      qs('.page').textContent = title;
      // mostrar/ocultar secciones simples
      qs('#cardProyectos').style.display = (sec==='mis-proyectos'|| !sec) ? 'block':'none';
      qs('#cardInformes').style.display = (sec==='informes') ? 'block':'none';
      if(sec==='encargos'){ // abrir drawer con el primer proyecto si existe
        const first = Store.assignedProjects(EMP_ID)[0]; if(first) openDrawer(first.id);
      }
    }));

    // Refresh informes
    qs('#refreshReports').addEventListener('click', renderInformes);

    // ===== Init =====
    function init(){
      Store.seed();
      renderProyectos();
      renderInformes();
    }
    document.addEventListener('DOMContentLoaded', init);

    // Expose for inline
    window.openDrawer = openDrawer;
    window.openReport = openReport;
  </script>
</body>
</html>
